// (c) 2013,2014 Elmyra UG - All rights reserved
function indicate_activity(e){e?($(".idler").hide(),$(".spinner").show()):($(".spinner").hide(),$(".idler").show())}function pdf_display(e,t,o){var i=new PDFObject({url:t+"?page="+o,id:"myPDF",pdfOpenParams:{navpanes:0,toolbar:0,statusbar:0,view:"FitB"}});i.embed(e)}function pdf_set_headline(e,t){var o=e+" Page "+t;$(".modal-header #ops-pdf-modal-label").empty().append(o)}function apply_highlighting(){_.each(opsChooserApp.metadata.get("keywords"),function(e){$(".keyword").keywordHighlight({keyword:e,caseSensitive:"false",contains:"true"})})}function hide_elements(){var e="print"==opsChooserApp.config.get("mode");e&&$(".do-not-print").hide();var t="liveview"==opsChooserApp.config.get("mode");t&&$(".non-liveview").hide()}function listview_bind_actions(){function e(e){var t=$(e).closest(".ops-collection-entry"),o=$(e).data("carousel");if(o){var i=o.getActiveIndex()+1;t.find(".drawing-number").text(i)}var n=$(e).data("totalcount");n&&t.find(".drawing-totalcount").text("/"+n)}hide_elements();var t="print"==opsChooserApp.config.get("mode");if(!t){$(".cql-query").shorten({showChars:125,moreText:"more",lessText:"less"}),$("#result-count-total").autoNumeric("init",{mDec:0}),$(opsChooserApp.paginationViewBottom.el).show(),opsChooserApp.basket_bind_actions(),$(".abstract").shorten({showChars:2e3,moreText:"more",lessText:"less"}),apply_highlighting(),$(".btn-popover").popover(),$(".inid-tooltip").tooltip(),$(".pdf-open").click(function(){var e=$(this).data("patent-number"),t=$(this).data("pdf-url"),o=1;pdf_set_headline(e,o),pdf_display("pdf",t,o),$("#pdf-previous").unbind(),$("#pdf-previous").click(function(){1!=o&&(o-=1,pdf_set_headline(e,o),pdf_display("pdf",t,o))}),$("#pdf-next").unbind(),$("#pdf-next").click(function(){o+=1,pdf_set_headline(e,o),pdf_display("pdf",t,o)})}),$(".query-link").unbind("click"),$(".query-link").on("click",function(){var e={mode:opsChooserApp.config.get("mode"),context:opsChooserApp.config.get("context"),project:opsChooserApp.config.get("project"),datasource:"ops"};opsChooserApp.project&&(e.project=opsChooserApp.project.get("name"));var t=$(this).attr("href"),o=$.url(t),i=o.param();if(_(i).extend(e),opsChooserApp.config.get("isviewer")){var n=this;opaque_param(i).then(function(e){$(n).attr("href","?"+e)})}else t+=_.string.contains(t,"?")?"&":"?",t+=jQuery.param(e),$(this).attr("href",t)}),$(".drawings-carousel").carousel({interval:null}),$(".drawings-carousel").bind("slid",function(){e(this)});var o=$(".drawings-carousel .carousel-control.right");o.click(function(){var e=$(this).closest(".ops-collection-entry").find(".drawings-carousel"),t=e.find(".carousel-inner"),o=t.find("div.active").index()+1,i=t.find("div").length;if(o==i){var n=e.data("totalcount");if(n&&!(i>=n)){var r=$(t).children(":first").clone(),a=$(t).height();$(r).removeClass("active");var s=$(r).children("img"),c=s.attr("src").replace(/\?page=.*/,"");c+="?page="+(o+1),s.attr("src",c),$(r).attr("min-height",a),$(r).height(a),$(t).append(r)}}}),$(".drawings-carousel").each(function(t,o){var o=$(o),i=o.data("totalcount");if(!i){i=1;var n=o.closest(".ops-collection-entry").data("document-number");if(!n)return void console.warn("document-number could not be found, won't proceed loading items into carousel");var r=_.template("/api/ops/<%= patent %>/image/info")({patent:n});$.ajax({url:r,async:!0}).success(function(t){t&&(i=t.META["drawing-total-count"],o.data("totalcount",i),e(o))}).error(function(e){console.warn("Error while fetching total count of drawings",e)}),o.data("totalcount",i),e(o)}});var i=$(".drawings-carousel").find("img");i.error(function(){$(this).hide();var e='<br/><blockquote class="text-center" style="min-height: 300px"><br/><br/><br/><br/><br/><br/>No image</blockquote>';$(this).closest(".carousel").hide().parent().find(".drawing-info").html(e)}),$(".embed-item").each(function(e,t){var o=$(t).data("embed-url"),i=$(t).data("document-number");if(o){var n=_.template(o,null,{interpolate:/\{\{(.+?)\}\}/g}),r=n({publication_number:i}),a='<iframe src="'+r+'" class="container-fluid well" seamless="seamless" height2="200" width2="100%" style="min-height: 50%; min-width: 80%"/>';$(this).append(a)}}),$('button[data-toggle="tab"]').on("show",function(e){var t=$($(e.target).attr("href")),o=$(this).data("document-number"),i=$(this).data("document-details-type");"description"==i?display_description(o,t):"claims"==i&&display_claims(o,t),$(".btn-popover").popover()})}}function display_description(e,t){var o=t.find(".document-details-content")[0],i=t.find(".document-details-language")[0];if(o){var n=_.template("/api/ops/<%= document_number %>/description")({document_number:e});$.ajax({url:n,async:!0}).success(function(t){if(t){var n=t["ops:world-patent-data"]["ftxt:fulltext-documents"]["ftxt:fulltext-document"].description;console.log("description",e,n);var r=_(to_list(n.p)).map(function(e){return"<p>"+_(e.$).escape().replace(/\n/g,"<br/><br/>")+"</p>"}),a=r.join("\n");$(o).html(a),$(i).html("["+n["@lang"]+"]"),apply_highlighting()}}).error(function(e){console.warn("Error while fetching description",e)})}}function display_claims(e,t){var o=t.find(".document-details-content")[0],i=t.find(".document-details-language")[0];if(o){var n=_.template("/api/ops/<%= document_number %>/claims")({document_number:e});$.ajax({url:n,async:!0}).success(function(t){if(t){var n=t["ops:world-patent-data"]["ftxt:fulltext-documents"]["ftxt:fulltext-document"].claims;console.log("claims",e,n);var r=_(to_list(n.claim["claim-text"])).map(function(e){return"<p>"+_(e.$).escape().replace(/\n/g,"<br/>")+"</p>"}),a=r.join("\n");$(o).html(a),$(i).html("["+n["@lang"]+"]"),apply_highlighting()}}).error(function(e){console.warn("Error while fetching claims",e)})}}function reset_content(e){$("#alert-area").empty(),$("#info-area").empty(),$("#pagination-info").hide(),e=e||{},e.keep_pager||$(".pager-area").hide(),e.documents&&opsChooserApp.documents.reset()}function getconfig(e,t){t=t||{};var o=opsChooserApp.config.get(e);return o&&(t.before&&(o=t.before+o),t.after&&(o+=t.after)),o}function boot_application(){console.log("boot_application"),$("#query").val(opsChooserApp.config.get("query")),$("#ui-title").html(getconfig("setting.ui.page.title")),$("#ui-subtitle").html(getconfig("setting.ui.page.subtitle")),$("#ui-productname").html(getconfig("setting.ui.productname")),$("#ui-footer").html(getconfig("setting.ui.page.footer",{after:"<br/>"})),$("#ui-footer-version").html(getconfig("setting.ui.version",{after:"<br/>"})),reset_content(),$(".btn-popover").popover(),$(".very-short").shorten({showChars:5,moreText:"more",lessText:"less"}),$.notify.defaults({className:"info",showAnimation:"fadeIn",hideAnimation:"fadeOut",autoHideDelay:4e3,showDuration:300}),$(".btn-query-perform").click(function(){opsChooserApp.perform_search({reviewmode:!1})}),$("#datasource").on("click",".btn",function(){opsChooserApp.set_datasource($(this).data("value"))}),$("#query").on("keydown",null,"meta+return",function(){opsChooserApp.perform_search({reviewmode:!1})}),$("#query").on("keydown",null,"ctrl+return",function(){opsChooserApp.perform_search({reviewmode:!1})}),_([document,"#query"]).each(function(e){$(e).on("keydown",null,"ctrl+shift+e",function(){$('#datasource button[data-value="ops"]').button("toggle"),opsChooserApp.set_datasource("ops")}),$(e).on("keydown",null,"ctrl+shift+d",function(){$('#datasource button[data-value="depatisnet"]').button("toggle"),opsChooserApp.set_datasource("depatisnet")}),$(e).on("keydown",null,"ctrl+shift+r",function(){opsChooserApp.basketModel.review()})}),$(document).on("keydown",null,"+",function(){opsChooserApp.viewport_document_add_basket()}),$(document).on("keydown",null,"insert",function(){opsChooserApp.viewport_document_rate(1)}),$(document).on("keydown",null,"-",function(){opsChooserApp.viewport_document_remove_basket()}),$(document).on("keydown",null,"r",function(){opsChooserApp.viewport_document_remove_basket()}),$(document).on("keydown",null,"del",function(){opsChooserApp.viewport_document_remove_basket()}),$(document).on("keydown",null,"ctrl+d",function(){opsChooserApp.viewport_document_remove_basket()}),$(document).on("keydown",null,"0",function(){opsChooserApp.viewport_document_rate(null,!0)}),$(document).on("keydown",null,"d",function(){opsChooserApp.viewport_document_rate(null,!0)}),$(document).on("keydown",null,"1",function(){opsChooserApp.viewport_document_rate(1)}),$(document).on("keydown",null,"2",function(){opsChooserApp.viewport_document_rate(2)}),$(document).on("keydown",null,"3",function(){opsChooserApp.viewport_document_rate(3)}),$(document).on("keydown",null,null,function(e){32==e.keyCode&&"body"==e.target.localName&&(e.preventDefault(),0==e.shiftKey?scroll_smooth(mainlist_next_element()):1==e.shiftKey&&scroll_smooth(mainlist_previous_element()))}),$(document).on("keydown",null,"pagedown",function(e){e.preventDefault(),scroll_smooth(mainlist_next_element())}),$(document).on("keydown",null,"pageup",function(e){e.preventDefault(),scroll_smooth(mainlist_previous_element())}),$(document).on("keydown",null,"right",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find(".document-actions .document-tab-chooser").first(),o=t.find("button.active"),i=o.next("button");i.length||(i=o.siblings("button").first()),i.tab("show")}),$(document).on("keydown",null,"left",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find(".document-actions .document-tab-chooser").first(),o=t.find("button.active"),i=o.prev("button");i.length||(i=o.siblings("button").last()),i.tab("show")}),$(document).on("keydown",null,"shift+right",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find(".drawings-carousel").first(),o=t.find(".carousel-control.right");o.trigger("click")}),$(document).on("keydown",null,"shift+left",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find(".drawings-carousel").first(),o=t.find(".carousel-control.left");o.trigger("click")}),$(document).on("keydown",null,"shift+p",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find("a.anchor-pdf-ops");t[0].click()}),$(document).on("keydown",null,"shift+e",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find("a.anchor-biblio-espacenet");t[0].click()}),$(document).on("keydown",null,"shift+d",function(e){e.preventDefault();var t=$(".ops-collection-entry:in-viewport").find("a.anchor-biblio-depatisnet");t[0].click()}),$(document).on("keydown",null,"alt+shift+e",function(e){e.preventDefault(),$(".ops-collection-entry:in-viewport").find("a.anchor-register-epo")[0].click()}),$(document).on("keydown",null,"alt+shift+d",function(e){e.preventDefault(),$(".ops-collection-entry:in-viewport").find("a.anchor-register-dpma")[0].click()}),$(document).on("keydown",null,"shift+c",function(e){e.preventDefault(),$(".ops-collection-entry:in-viewport").find("a.anchor-ccd")[0].click()}),$("#btn-query-clear").click(function(){$("#query").val("").focus()}),$("#btn-query-transform").click(function(){$("#query").val().trim()&&$("#clipboard-modifier-chooser").modal("show")}),$("#btn-query-history").click(function(e){cql_history_chooser_setup();var t=$("#cql-history-chooser").hasClass("open"),o=$("#cql-history-chooser-select2");t?(e.preventDefault(),e.stopPropagation(),o.select2("open")):setTimeout(function(){o.select2("open")})}),$(".btn-clipboard-modifier").click(function(){var e=$(this).data("modifier"),t=$("#clipboard-modifier-operator").find(".btn.active").data("value")||"OR";$("#clipboard-modifier-chooser").modal("hide");var o=$("#query").val().trim();if(!_.str.contains(o,"=")){var i=o.split("\n"),n=_(i).map(function(t){return e+'="'+t+'"'}).join(" "+t+" ");$("#query").val(n),$("#query").focus()}}),$(".btn-cql-boolean").button(),$("#cql-quick-operator").find(".btn-cql-boolean").click(function(){$("#query").focus()}),$(".btn-cql-field").click(function(){var e,t=$("#query").val(),o=$("#cql-quick-operator").find(".btn-cql-boolean.active").data("value"),i=$(this).data("value"),n=$("#query").caret(),r=!1,a=!0;if(0!=n){r=!0,e=t.substring(n-1,n),"="==e&&(r=!1,a=!1);var s=t.substring(n-5,n).toLowerCase();(_.string.contains(s,"and")||_.string.contains(s,"or"))&&(r=!1)}var c=e&&" "!=e?" ":"";r&&$("#query").caret(c+o),a&&$("#query").caret((r?" ":c)+i),$("#query").focus()});var e=opsChooserApp.config.get("datasource");e&&opsChooserApp.set_datasource(e),$("#link-help").click(function(){$("#help-modal").modal("show")}),opsChooserApp.trigger("application:ready"),hide_elements()}function mainlist_next_element(){var e,t=$(".ops-collection-entry:in-viewport");if($(window).scrollTop()<t.offset().top)e=t;else{var e=t.closest(".ops-collection-entry").last();e[0]===t[0]&&(e=$(".ops-collection-entry:below-the-fold").first())}return e}function mainlist_previous_element(){var e,t=$(".ops-collection-entry:in-viewport");if($(window).scrollTop()>t.offset().top)e=t;else{var e=t.closest(".ops-collection-entry").first();e[0]===t[0]&&(e=$(".ops-collection-entry:above-the-top").last())}return e}function scroll_smooth(e){$(e).offset()&&$("html, body").animate({scrollTop:$(e).offset().top},500)}function cql_field_chooser_get_data(e){return"ops"==e?OPS_CQL_FIELDS:"depatisnet"==e?DEPATISNET_CQL_FIELDS:[]}function cql_field_chooser_setup(){var e=opsChooserApp.get_datasource();if(!e||"review"==e){var t=$("#cql-field-chooser")[0].previousSibling;return void $(t).hide()}var o=cql_field_chooser_get_data(e);$("#cql-field-chooser").select2({placeholder:"CQL field symbols ("+e+")",data:{results:o},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}}),$("#cql-field-chooser").on("change",function(){var e=$(this).val();if(e){var t=$("#query").val(),o=$("#query").caret(),i=t.substring(o-1,o);"="!=i&&(" "!=i&&0!=o&&(e=" "+e),$("#query").caret(e+"="),$(this).data("select2").clear())}})}function cql_history_chooser_get_data(){var e=opsChooserApp.project.get("queries"),t=_(e).unique().map(function(e){return{id:e,text:e}});return t}function cql_history_chooser_setup(){var e=opsChooserApp.project.get("name"),t=cql_history_chooser_get_data(),o=$("#cql-history-chooser-select2");o.select2({placeholder:"CQL history ("+e+")",data:{results:t},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}}),o.unbind("change"),o.on("change",function(){$(this).unbind("change");var e=$(this).val();e&&(_.string.endsWith(e,"(ops)")?opsChooserApp.set_datasource("ops"):_.string.endsWith(e,"(depatisnet)")&&opsChooserApp.set_datasource("depatisnet"),e=e.replace(" (ops)","").replace(" (depatisnet)",""),$("#query").val(e)),$(this).data("select2").destroy(),$(this).dropdown().toggle()})}function cql_field_chooser_text(e,t,o){var i=_.template($("#cql-field-chooser-entry").html());t=t.map(function(e){return e+"="});var n=i({label:e,fields:t,more:o});return n}function to_list(e){return _.isArray(e)&&e||[e]}function now_iso(){return moment().format()}function now_iso_human(){return moment().format("YYYY-MM-DD HH:mm:ss")}function today_iso(){return moment().format("YYYY-MM-DD")}function changeTooltipColorTo(e){$(".tooltip-inner").css("background-color",e),$(".tooltip.top .tooltip-arrow").css("border-top-color",e),$(".tooltip.right .tooltip-arrow").css("border-right-color",e),$(".tooltip.left .tooltip-arrow").css("border-left-color",e),$(".tooltip.bottom .tooltip-arrow").css("border-bottom-color",e)}function quotate(e){return'"'+e+'"'}function asbool(e){switch("string"==typeof e&&(e=e.trim().toLowerCase()),e){case!0:case"true":case 1:case"1":case"on":case"yes":return!0;default:return!1}}function dotresolve(e,t){for(t=t.split(".");e&&t[0];)e=e[t.shift()]||void 0;return e}function opaquetoken(e){var t=$.Deferred();return $.ajax({method:"post",url:"/api/opaquelinks/token",async:!1,sync:!0,data:JSON.stringify(e),contentType:"application/json; charset=utf-8"}).success(function(e){e&&t.resolve(e)}).error(function(e){console.warn("Error while signing opaque parameters",e),t.reject(e)}),t.promise()}function opaquetoken_query(e){var t=$.Deferred();return opaquetoken(e).then(function(e){var o="op="+e;t.resolve(o)}),t.promise()}function opaque_param(e){return e=e||{},e.op?$.Deferred().resolve("op="+e.op):opaquetoken_query(e)}OpsChooserApp=Backbone.Marionette.Application.extend({get_datasource:function(){var e=$("#datasource > .btn.active").data("value");return e},set_datasource:function(e){$("#datasource > .btn[data-value='"+e+"']").button("toggle"),cql_field_chooser_setup(),"review"==e?$("#query").prop("disabled",!0):$("#query").prop("disabled",!1)},perform_search:function(e){this.metadata.resetSomeDefaults();var t=$("#query").val(),o=this.get_datasource();console.log("App.perform_search: datasource="+o,"query="+t,"options=",e),e&&null!=e.reviewmode&&this.metadata.set("reviewmode",e.reviewmode);var i=this.metadata.get("reviewmode");if(1==i)return void this.basketModel.review(e);if(!_.isEmpty(t)){var n=this;if(this.metadata.set("datasource",o),"ops"==o){var r=this.compute_range(e);this.trigger("search:before",{datasource:o,query:t,range:r}),opsChooserApp.search.perform(this.documents,this.metadata,t,r).done(function(){n.metadata.set("keywords",opsChooserApp.search.keywords),n.trigger("results:ready")})}else if("depatisnet"==o){this.trigger("search:before",{datasource:o,query:t}),this.metadata.set("query_origin",t);var a=new DepatisnetSearch;a.perform(t).done(function(o){n.propagate_depatisnet_message(o),n.metadata.set("keywords",a.keywords),console.log("depatisnet response:",o);var i=o.data,r=o.hits;n.perform_listsearch(e,t,i,r,"pn","OR").done(function(){n.propagate_depatisnet_message(o)})})}}},send_query:function(e,t){e&&($("#query").val(e),opsChooserApp.perform_search(t),$(window).scrollTop(0))},perform_listsearch:function(e,t,o,i,n,r){indicate_activity(!1),reset_content({keep_pager:!0,documents:!0});var a=e&&e.range?e.range:"1-10",s=a.split("-"),c=parseInt(s[0])-1,l=parseInt(s[1]);if(o&&(0==o.length||c>o.length)){var u=$.Deferred();if(u.resolve(),_.isEmpty(t)&&_.isEmpty(o))return reset_content({keep_pager:!1,documents:!0}),this.user_alert("No results.","info"),u.promise()}var d=_(_.map(o,function(e){return n+"="+e})),p=d.join(" "+r+" "),h=d.slice(c,l).join(" "+r+" ");console.log("OPS sliced CQL query:",h),t||(t=p),this.metadata.set("page_size",10),this.metadata.set("searchmode","subsearch");var m=this;return opsChooserApp.search.perform(this.documents,this.metadata,h,"1-10").done(function(){m.metadata.set("query_origin",t),m.metadata.set("result_count",i),m.metadata.set("result_range",a),m.metadata.set("pagination_entry_count",17),$(".pagination").removeClass("span10"),$(".pagination").addClass("span12"),m.trigger("results:ready")})},compute_range:function(e){var t=this.metadata.get("page_size"),o="1-"+t,i=e&&e.range?e.range:o;return i},propagate_depatisnet_message:function(e){this.user_alert(e.message,"warning")},user_alert:function(e,t){if(e){var o="INFO",i="alert-info";"warning"==t&&(o="WARNING",i="alert-warning");var n=_.template($("#alert-template").html()),r={title:o,description:e,clazz:i},a=n(r);$("#info-area").append(a)}},project_activate:function(e){var t=this;if(!e)return void console.error("project is null, will not activate");var o=e.get("name");console.log("App.project_activate:",o),this.project&&(this.stopListening(this.project),delete this.project),this.project=e,this.stopListening(this,"search:before"),this.listenTo(this,"search:before",function(t){e.record_query(t)}),$(window).off("focus",this.project_reload),$(window).on("focus",this.project_reload),this.projectChooserView=new ProjectChooserView({el:$("#project-chooser-area"),model:e,collection:e.collection}),this.projectChooserView.render(),$("#ui-project-dates").html("created "+moment(e.get("created")).fromNow()+", modified "+moment(e.get("modified")).fromNow());var i=e.get("basket");i.fetch({success:function(){$.when(i.fetch_entries()).then(function(){t.basket_activate(i)})}})},project_reload:function(){var e=opsChooserApp.project.get("name");opsChooserApp.trigger("project:load",e)},basket_activate:function(e){return console.log("App.basket_activate"),e?(e.init_from_query(),this.basketModel&&(this.stopListening(this.basketModel),delete this.basketModel),this.basketModel=e,this.basketView&&(this.stopListening(this.basketView),delete this.basketView),this.basketView=new BasketView({el:$("#basket-area"),model:e}),this.stopListening(null,"change:add"),this.stopListening(null,"change:remove"),this.listenTo(e,"change:add",this.basketView.link_document),this.listenTo(e,"change:remove",this.basketView.link_document),this.listenTo(e,"change:rate",this.basketView.link_document),this.stopListening(null,"change"),this.listenTo(e,"change",function(){this.project.save()}),this.listenTo(e,"change:add",function(e,t){this.basketView.textarea_scroll_text(t)}),this.basketView.render(),this.basket_bind_actions(),void this.trigger("basket:activated",e)):void console.error("basket is null, will not activate")},basket_bind_actions:function(){var e=this;$(".add-patent-number").unbind("click"),$(".add-patent-number").click(function(){var t=$(this).data("patent-number");e.basketModel.add(t)}),$(".remove-patent-number").unbind("click"),$(".remove-patent-number").click(function(){var t=$(this).data("patent-number");e.basketModel.remove(t)}),$("#basket-add-all-documents").unbind("click"),$("#basket-add-all-documents").click(function(){e.documents.each(function(t){var o=t.attributes.get_patent_number();e.basketModel.add(o)})}),console.log("setup rating widget"),$(".rating-widget").raty({number:3,hints:["slightly relevant","relevant","important"],cancel:!0,cancelHint:"not relevant",dismissible:!0,path:"/static/widget/raty/img",action:function(t){var o=t.score,i=t.dismiss,n=$(this).data("document-number");e.document_rate(n,o,i)}}),this.documents.each(function(t){var o=t.attributes.get_patent_number();if(e.basketModel){var i=e.basketModel.get_entry_by_number(o);e.basketView.link_document(i,o)}else e.basketView.link_document(void 0,o)})},get_document_number_in_focus:function(){var e=_.first($(".document-actions:in-viewport").closest(".ops-collection-entry")),t=$(e).data("document-number");return t},get_rating_widget:function(e){return $("#rate-patent-number-"+e)},viewport_document_add_basket:function(){var e=this.get_document_number_in_focus();e&&this.basketModel.add(e)},viewport_document_remove_basket:function(){var e=this.get_document_number_in_focus();e&&this.basketModel.remove(e)},viewport_document_rate:function(e,t){t=t||!1;var o=this.get_document_number_in_focus();return this.document_rate(o,e,t)},document_rate:function(e,t,o){var i=this;e&&this.basketModel.add(e).then(function(n){n.save({score:t,dismiss:o},{success:function(){i.basketModel.trigger("change:rate",n,e),i.basketView.textarea_scroll_text(e)},error:function(){console.error("rating save error",e,n)}})})},shutdown_gui:function(){this.basketModel.destroy(),this.basket_bind_actions(),this.basketView.render(),this.comments.store.set(),this.projects.reset(),this.projectChooserView.clear()}}),opsChooserApp=new OpsChooserApp({config:ipsuiteNavigatorConfig}),opsChooserApp.addRegions({metadataRegion:"#ops-metadata-region",listRegion:"#ops-collection-region",paginationRegionTop:"#ops-pagination-region-top",paginationRegionBottom:"#ops-pagination-region-bottom"}),opsChooserApp.addInitializer(function(){this.storage=new StoragePlugin,this.listenTo(this,"application:ready",function(){this.storage.setup_ui()}),this.listenTo(this,"results:ready",function(){this.storage.setup_ui()})}),opsChooserApp.addInitializer(function(){localforage.setDriver("localStorageWrapper"),localforage.config({name:this.config.get("context")});var e=this.config.get("database");e&&("viewer"==this.config.get("context")&&this.storage.dbreset(),this.LOAD_IN_PROGRESS=!0,this.storage.dbimport(e))}),opsChooserApp.addInitializer(function(){this.search=new OpsPublishedDataSearch,this.metadata=new OpsExchangeMetadata,this.documents=new OpsExchangeDocumentCollection}),opsChooserApp.addInitializer(function(){this.metadataView=new MetadataView({model:this.metadata}),this.collectionView=new OpsExchangeDocumentCollectionView({collection:this.documents}),this.paginationViewTop=new PaginationView({model:this.metadata}),this.paginationViewBottom=new PaginationView({model:this.metadata}),opsChooserApp.metadataRegion.show(this.metadataView),opsChooserApp.listRegion.show(this.collectionView),opsChooserApp.paginationRegionTop.show(this.paginationViewTop),opsChooserApp.paginationRegionBottom.show(this.paginationViewBottom)}),opsChooserApp.addInitializer(function(){}),opsChooserApp.addInitializer(function(){this.listenTo(this,"results:ready",function(){this.metadata.trigger("commit"),listview_bind_actions()}),this.listenTo(this,"project:ready",this.project_activate),this.listenToOnce(this,"project:ready",this.perform_search)}),$(document).ready(function(){console.log("document.ready"),opsChooserApp.start(),boot_application()});var OPS_CQL_FIELDS=[{text:"<h4>Popular</h4>",children:[{id:"num",text:cql_field_chooser_text("Publication-, application- or<br/>priority number",["num"],"(10, 11, 21, 31)")},{id:"txt",text:cql_field_chooser_text("Title, abstract, inventor-, or applicant name",["txt"],"(54, 57, 72, 71, 73)")},{id:"cl",text:cql_field_chooser_text("CPC or IPC8 class",["cl"],"")}]},{text:"<h4>Publication</h4>",children:[{id:"pn",text:cql_field_chooser_text("Publication number",["pn","publicationnumber"],"(10, 11)")},{id:"pd",text:cql_field_chooser_text("Publication date",["pd","publicationdate"],"")},{id:"pa",text:cql_field_chooser_text("Applicant",["pa","applicant"],"(71, 73)")},{id:"in",text:cql_field_chooser_text("Inventor",["in","inventor"],"(72)")},{id:"ia",text:cql_field_chooser_text("Inventor or applicant",["ia","inventorandapplicant"],"(72, 71, 73)")},{id:"spn",text:cql_field_chooser_text("Publication number<br/><small>in epodoc format</small>",["spn"],"")}]},{text:"<h4>Text</h4>",children:[{id:"ti",text:cql_field_chooser_text("Title",["ti","title"],"(54)")},{id:"ab",text:cql_field_chooser_text("Abstract",["ab","abstract"],"(57)")},{id:"ta",text:cql_field_chooser_text("Title or abstract",["ta","titleandabstract"],"(54, 57)")},{id:"txt",text:cql_field_chooser_text("Title, abstract, inventor-, or applicant name",["txt"],"(54, 57, 72, 71, 73)")}]},{text:"<h4>Application, priority and family</h4>",children:[{id:"ap",text:cql_field_chooser_text("Application number",["ap","applicantnumber"],"(21)")},{id:"sap",text:cql_field_chooser_text("Application number<br/><small>in epodoc format</small>",["sap"],"")},{id:"pr",text:cql_field_chooser_text("Priority number",["pr","prioritynumber"],"(31)")},{id:"spr",text:cql_field_chooser_text("Priority number<br/><small>in epodoc format</small>",["spr"],"")},{id:"famn",text:cql_field_chooser_text("Family identifier (simple)",["famn"],"")}]},{text:"<h4>Classification</h4>",children:[{id:"cpc",text:cql_field_chooser_text("CPC classification<br/><small>(invention and additional)</small>",["cpc","cpci","cpca"],"")},{id:"ipc",text:cql_field_chooser_text("IPC8 class",["ipc","ic"],"")},{id:"ci",text:cql_field_chooser_text("IPC8 core invention class",["ci"],"")},{id:"cn",text:cql_field_chooser_text("IPC8 core additional class<br/><small>(non-invention)</small>",["cn"],"")},{id:"ai",text:cql_field_chooser_text("IPC8 advanced invention class",["ai"],"")},{id:"an",text:cql_field_chooser_text("IPC8 advanced additional class<br/><small>(non-invention)</small>",["an"],"")},{id:"a",text:cql_field_chooser_text("IPC8 advanced class",["a"],"")},{id:"c",text:cql_field_chooser_text("IPC8 core class",["c"],"")},{id:"cl",text:cql_field_chooser_text("CPC or IPC8 class",["cl"],"")}]},{text:"<h4>Citations</h4>",children:[{id:"ct",text:cql_field_chooser_text("Cited document number",["ct","citation"],"(56)")},{id:"ex",text:cql_field_chooser_text("Cited document number<br/><small>during examination</small>",["ex"],"")},{id:"op",text:cql_field_chooser_text("Cited document number<br/><small>during opposition</small>",["op"],"")},{id:"rf",text:cql_field_chooser_text("Cited document number<br/><small>provided by applicant</small>",["rf"],"")},{id:"oc",text:cql_field_chooser_text("Another cited document number",["oc"],"")}]}],DEPATISNET_CQL_FIELDS=[{text:"<h4>Publication</h4>",children:[{id:"pn",text:cql_field_chooser_text("Publication number",["pn"],"(10, 11)")},{id:"pc",text:cql_field_chooser_text("Country of publication",["pc"],"(19)")},{id:"pub",text:cql_field_chooser_text("Publication date",["pub"],"")},{id:"py",text:cql_field_chooser_text("Publication year",["py"],"")},{id:"pa",text:cql_field_chooser_text("Applicant/Owner",["pa"],"(71, 73)")},{id:"in",text:cql_field_chooser_text("Inventor",["in"],"(72)")},{id:"pcod",text:cql_field_chooser_text("Kind code",["pcod"],"(12)")}]},{text:"<h4>Text</h4>",children:[{id:"ti",text:cql_field_chooser_text("Title",["ti"],"(54)")},{id:"ab",text:cql_field_chooser_text("Abstract",["ab"],"(57)")},{id:"de",text:cql_field_chooser_text("Description",["de"],"")},{id:"cl",text:cql_field_chooser_text("Claims",["cl"],"(57)")},{id:"bi",text:cql_field_chooser_text("Full text data",["bi"])}]},{text:"<h4>Application</h4>",children:[{id:"an",text:cql_field_chooser_text("Application number",["ap"],"(21)")},{id:"ac",text:cql_field_chooser_text("Country of application",["ac"],"")},{id:"ad",text:cql_field_chooser_text("Application date",["ad"],"(22, 96)")},{id:"ay",text:cql_field_chooser_text("Application year",["ay"],"")}]},{text:"<h4>Priority</h4>",children:[{id:"prn",text:cql_field_chooser_text("Priority number",["prn"],"(31)")},{id:"prc",text:cql_field_chooser_text("Country of priority",["prc"],"(33)")},{id:"prd",text:cql_field_chooser_text("Priority date",["prd"],"(32)")},{id:"pry",text:cql_field_chooser_text("Priority year",["pry"],"")}]},{text:"<h4>Citations</h4>",children:[{id:"ct",text:cql_field_chooser_text("Cited documents",["ct"],"(56)")},{id:"ctnp",text:cql_field_chooser_text("Cited non-patent literature",["ctnp"],"(56)")}]},{text:"<h4>Bibliographic IPC</h4>",children:[{id:"icb",text:cql_field_chooser_text("Bibliographic IPC",["icb"],"")},{id:"icm",text:cql_field_chooser_text("IPC main class",["icm"],"(51)")},{id:"ics",text:cql_field_chooser_text("IPC secondary class",["ics"],"(51)")},{id:"ica",text:cql_field_chooser_text("IPC additional class",["ica"],"")},{id:"ici",text:cql_field_chooser_text("IPC index classes",["ici"],"")},{id:"icmv",text:cql_field_chooser_text("IPC main class version",["icmv"],"")},{id:"icsv",text:cql_field_chooser_text("IPC secondary class version",["icsv"],"")},{id:"icav",text:cql_field_chooser_text("IPC additional class version",["icav"],"")},{id:"icml",text:cql_field_chooser_text("IPC main class level",["icml"],"")},{id:"icsl",text:cql_field_chooser_text("IPC secondary class level",["icsl"],"")},{id:"ical",text:cql_field_chooser_text("IPC additional class level",["ical"],"")}]},{text:"<h4>Reclassified IPC</h4>",children:[{id:"mcd",text:cql_field_chooser_text("Reclassified IPC",["mcd"],"")},{id:"mcm",text:cql_field_chooser_text("MCD main class",["mcm"],"")},{id:"mcs",text:cql_field_chooser_text("MCD secondary class",["mcs"],"")},{id:"mca",text:cql_field_chooser_text("MCD additional class",["mca"],"")},{id:"mcml",text:cql_field_chooser_text("MCD main class level",["mcml"],"")},{id:"mcsl",text:cql_field_chooser_text("MCD secondary class level",["mcsl"],"")},{id:"mcal",text:cql_field_chooser_text("MCD additional class level",["mcal"],"")}]}];timestamp=now_iso;var log=Function.prototype.bind.call(console.log,console);_.clear=function(e){e.length=0},function(e){e.fn.extend({qnotify:function(t,o){o=o||{},_.defaults(o,{className:"info",position:"bottom"}),o.error&&(o.className="error"),(o.warn||o.warning)&&(o.className="warning"),e(this).notify(t,o)}})}(jQuery),_.mixin({objMap:function(e,t,o){return _.reduce(e,function(i,n,r){return i[r]=t.call(o,n,r,e),i},{},o)},objFilter:function(e,t,o){return _.reduce(e,function(i,n,r){return t.call(o,n,r,e)&&(i[r]=n),i},{},o)},objReject:function(e,t,o){return _.reduce(e,function(i,n,r){return t.call(o,n,r,e)||(i[r]=n),i
},{},o)}}),BasketModel=Backbone.RelationalModel.extend({sync:Backbone.localforage.sync("Basket"),relations:[{type:Backbone.HasMany,key:"entries",relatedModel:"BasketEntryModel",includeInJSON:Backbone.Model.prototype.idAttribute}],defaults:{},initialize:function(){console.log("BasketModel.initialize"),this.fetchRelated||(this.fetchRelated=this.getAsync)},init_from_query:function(){var e=this,t=$.url(window.location.href),o="numberlist",i=t.param(o);if(i){i=decodeURIComponent(i);var n=i.split(/[,\n]/);_(n).each(function(t){e.add(t.trim())})}},get_entry_by_number:function(e){var t=this.get("entries").where({number:e});return _.isEmpty(t)?void 0:t[0]},add:function(e){var t=this,o=$.Deferred(),i=this.get_entry_by_number(e);if(i)return i.fetch({success:function(){o.resolve(i),t.trigger("change",t)}}),o.promise();var n=_.find(opsChooserApp.documents.models,function(t){var o=t.get_document_number();return e==o}),r=n?n.attributes.get_title_list():void 0;return i=new BasketEntryModel({number:e,timestamp:now_iso(),title:r}),i.save(null,{success:function(){var n=t.get("entries");n.add(i),t.save({entries:n},{success:function(){$.when(t.fetch_entries()).then(function(){o.resolve(t.get_entry_by_number(i.get("number"))),t.trigger("change",t),t.trigger("change:add",i,e)})}})}}),o.promise()},remove:function(e){var t=this,o=this.get_entry_by_number(e);if(o){var i=this.get("entries");i.remove(o),o.destroy(),t.save({entries:i},{success:function(){$.when(t.fetch_entries()).then(function(){t.trigger("change:remove",o,e),t.trigger("change",t)})}})}},get_numbers:function(){return this.get("entries").invoke("get","number")},review:function(e){var t=this.get_numbers(),o=t.length;opsChooserApp.set_datasource("review"),opsChooserApp.metadata.set("reviewmode",!0),opsChooserApp.perform_listsearch(e,void 0,t,o,"pn","OR")},fetch_entries:function(){var e=this,t=$.Deferred();return $.when(this.fetchRelated("entries")).then(function(){var o=[];e.get("entries").each(function(e){var t=$.Deferred();o.push(t.promise()),e.fetch({success:function(){t.resolve(e)},error:function(){console.log("error while fetching basket entry:",e),e.save(null,{success:function(){console.log("success"),t.resolve(e)},error:function(){console.log("error"),t.resolve(e)}})}})}),$.when.apply($,o).then(function(){t.resolve()})}),t.promise()}}),BasketEntryModel=Backbone.RelationalModel.extend({sync:Backbone.localforage.sync("BasketEntry"),defaults:{number:void 0,timestamp:void 0,title:void 0,score:void 0,dismiss:void 0},initialize:function(){console.log("BasketEntryModel.initialize")}}),BasketView=Backbone.Marionette.ItemView.extend({template:"#basket-template",initialize:function(){console.log("BasketView.initialize"),this.listenTo(this.model,"change",this.render),this.listenTo(this,"item:rendered",this.setup_ui),this.templateHelpers.config=opsChooserApp.config},templateHelpers:{},serializeData:function(){var e={};e=this.model.toJSON();var t=this.model.get("entries").map(function(e){var t=_.string.ljust(e.get("number"),20," ")+_.string.ljust(e.get("dismiss")?"∅":"",5," ")+_.string.repeat("★",e.get("score"));return t});return t&&(e.numbers_display=t.join("\n")),e},setup_ui:function(){console.log("BasketView.setup_ui");var e=this;$("#basket-import-button").click(function(){return e.future_premium_feature(),!1});var t=opsChooserApp.config.get("ship-url");t?$("#basket-submit-button").prop("disabled",!1):$("#basket-submit-button").prop("disabled",!0),$(".basket-review-button").unbind("click"),$(".basket-review-button").click(function(){e.model.review()}),$("#share-numberlist-email").unbind("click"),$("#share-numberlist-email").click(function(){var t=opsChooserApp.project.get("name"),o=e.model.get_numbers(),i=o.length,n=o.join("\n"),r=_.template("[IPSUITE] Shared <%= count %> patent numbers through project <%= projectname %> at <%= date %>")({count:i,date:now_iso_human(),projectname:t}),a=n+"\r\n\r\n--\r\nPowered by https://patentsearch.elmyra.de/",s=_.template("mailto:?subject=<%= subject %>&body=<%= body %>")({subject:encodeURIComponent(r),body:encodeURIComponent(a)});$(this).attr("href",s)}),$("#share-documents-transfer").unbind("click"),$("#share-documents-transfer").click(function(){e.future_premium_feature()});var o=this.model.get("entries").length;$(".basket-entry-count").text(o)},future_premium_feature:function(){bootbox.dialog("Available soon via subscription.",[{label:"OK",icon:"OK",callback:null}],{header:"Future feature"})},onDomRefresh:function(){console.log("BasketView.onDomRefresh")},link_document:function(e,t){var o=opsChooserApp.basketModel.get_numbers(),i=$("#chk-patent-number-"+t),n=$("#add-patent-number-"+t),r=$("#remove-patent-number-"+t),a=$("#rate-patent-number-"+t),s=a.closest(".ops-collection-entry-heading");if(_(o).contains(t)){if(i&&i.prop("checked",!0),n&&n.hide(),r&&r.show(),e){var c=e.get("score"),l=e.get("dismiss");a.raty("score",c),a.raty("dismiss",l),s.toggleClass("dismiss",Boolean(l)),s.toggleClass("score1",1==c),s.toggleClass("score2",2==c),s.toggleClass("score3",3==c)}}else i&&i.prop("checked",!1),n&&n.show(),r&&r.hide(),a.raty("reload"),s.toggleClass("dismiss",!1),s.toggleClass("score1",!1),s.toggleClass("score2",!1),s.toggleClass("score3",!1)},textarea_scroll_bottom:function(){$("#basket").scrollTop($("#basket")[0].scrollHeight)},textarea_scroll_text:function(e){var t=$("#basket"),o=t.text().search(e);o&&t.scrollTop(o)}}),opsChooserApp.addInitializer(function(){this.listenTo(this,"application:ready",function(){"review"==this.config.get("datasource")&&this.listenToOnce(this,"basket:activated",function(e){e.review()})})}),CommentModel=Backbone.RelationalModel.extend({sync:Backbone.localforage.sync("Comment"),relations:[{type:Backbone.HasOne,key:"project",relatedModel:"ProjectModel",includeInJSON:Backbone.Model.prototype.idAttribute}],defaults:{parent:void 0,created:void 0,modified:void 0,author:void 0,text:void 0},initialize:function(){console.log("CommentModel.initialize")},save:function(e,t,o){null==e||"object"==typeof e?(attrs=e,o=t):(attrs={})[e]=t,o=_.extend({},o);var i=this,n=timestamp(),r=this.isNew(),a={};r&&(a.created=n),a.modified=n,this.set(a);var s=this.get("project"),c=o.success;return o.success=function(e,t,o){r?i.collection.create(e,{success:function(){o.isNew=r,i.collection.add(e),e.set("project",s),i.trigger("saved",e,t,o),c&&c(e,t,o)}}):(i.trigger("saved",e,t,o),c&&c(e,t,o))},Backbone.Model.prototype.save.call(this,attrs,o)}}),CommentCollection=Backbone.Collection.extend({sync:Backbone.localforage.sync("Comment"),find:Backbone.localforage.find,model:CommentModel,initialize:function(){console.log("CommentCollection.initialize")},get_or_create:function(e){var t=_(this.where(e)).first();return t||(t=this.model.build(e,{collection:this,parsed:!1})),t},by_project_and_document_number:function(e,t){return this.get_or_create({project:e,parent:t})}}),CommentButtonView=Backbone.Marionette.ItemView.extend({template:"#template-comment-button",tagName:"span",triggers:{click:"toggle"}}),CommentTextView=Backbone.Marionette.ItemView.extend({template:"#template-comment-text",tagName:"span",initialize:function(){console.log("CommentTextView.initialize"),this.listenTo(this.model,"remove",this.clear)},onRender:function(){var e=this.get_textarea();e.val(this.model.get("text"))},clear:function(){this.get_textarea().val(void 0)},get_widget:function(){return $(this.el).find(":first-child").first()},get_textarea:function(){return $(this.el).find("textarea")},toggle:function(){var e=this;this.get_widget().slideToggle();var t=this.get_textarea();t.off("blur"),t.on("blur",function(){var o=t.val();e.save(o)})},save:function(e){var t=this.model.get("text");return e!=t?(this.model.set({text:e}),this.model.save()):void 0}}),CommentManager=Marionette.Controller.extend({initialize:function(e){log("CommentManager.initialize"),this.collection=e.collection,this.project=e.project,this.itemview=e.itemview,this.model=this.get_or_create(),this.comment_button=new CommentButtonView,this.comment_text=new CommentTextView({model:this.model,collection:this.collection}),this.itemview.region_comment_button.show(this.comment_button),this.itemview.region_comment_text.show(this.comment_text),this.listenTo(this.comment_button,"toggle",this.toggle_edit)},toggle_edit:function(){this.comment_text.toggle()},get_or_create:function(){var e=this.itemview.model.get_document_number(),t=this.collection.by_project_and_document_number(this.project,e);return t}}),CommentsPlugin=Marionette.Controller.extend({initialize:function(e){console.log("CommentsPlugin.initialize");this.view=e.view,this.itemviews=[],this.store=new CommentCollection,this.store.fetch({success:function(){log("CommentsPlugin: fetch ready")}}),this.listenTo(this.view,"itemview:item:rendered",function(e){e.comment_manager=this.comment_factory(e),this.itemviews.push(e)}),this.listenTo(this.view,"collection:before:render",function(){_.clear(this.itemviews)}),this.listenTo(this.view,"collection:before:close",function(){_.clear(this.itemviews)}),this.listenTo(opsChooserApp,"project:changed",function(){var e=this;_(this.itemviews).each(function(t){t.comment_manager=e.comment_factory(t)})}),this.bind_hotkeys()},comment_factory:function(e){var t=opsChooserApp.project;return log("comment_factory using project:",t),new CommentManager({collection:this.store,project:t,itemview:e})},bind_hotkeys:function(){var e=this;$(document).on("keydown",null,"C",function(){e.viewport_toggle_comment()})},viewport_toggle_comment:function(){var e=$(".document-actions:in-viewport").closest(".ops-collection-entry").backboneView();e.comment_manager&&e.comment_manager.toggle_edit()}}),opsChooserApp.addInitializer(function(){this.LOAD_IN_PROGRESS?this.listenTo(this,"projects:initialize",function(){this.comments=new CommentsPlugin({view:this.collectionView})}):this.comments=new CommentsPlugin({view:this.collectionView})}),PermalinkPlugin=Marionette.Controller.extend({initialize:function(){console.log("PermalinkPlugin.initialize")},dataurl:function(){var e=$.Deferred();return opsChooserApp.storage.dump().then(function(t){var o=JSON.stringify(t),i=dataurl.format({data:o,mimetype:"application/json+lz-string",charset:"utf-8"});return e.resolve(i)}),e.promise()},permalink_params:function(e){e=e||{};var t=$.Deferred(),o=opsChooserApp.project.get("name"),i={},n=$.url(window.location.href);return _(i).extend(n.param()),_(i).extend(e),this.dataurl().then(function(e){_(i).extend({project:o,database:e}),i=_.objReject(i,function(e){return _.isEmpty(e)}),t.resolve(i)}),t.promise()},permalink_uri:function(e){var t=$.Deferred(),o=opsChooserApp.config.get("baseurl");return this.permalink_params(e).then(function(e){var i=o+"?"+jQuery.param(e);t.resolve(i)}),t.promise()},permalink_uri_opaque:function(e){var t=$.Deferred(),o=opsChooserApp.config.get("baseurl"),i=opsChooserApp.config.get("request.host");return"patentsearch.elmyra.de"==i&&(o="https://patentview.elmyra.de/"),this.permalink_params(e).then(function(e){opaque_param(e).then(function(e){var i=o+"?"+e;t.resolve(i)})}),t.promise()},popover_switch:function(e,t){var o=$(e).popover();if(!o.data("amended")){o.data("amended",!0);var i=o.data("content");$(e).popover("destroy"),$(e).popover({title:i,content:t,html:!0,placement:"bottom",trigger:"manual"})}},popover_toggle:function(e,t){$(e).popover("toggle");var o=$(e).popover().data("popover").$tip,i=o.hasClass("in");i&&(t&&$(o).find("#permalink-uri").val(t),$(o).find("#permalink-uri").select())},get_popover_content:function(){var e='<input id="permalink-uri" type="text"></input><br/><small>Please copy the link above for sharing.</small>';return e},setup_ui:function(){var e=this;$(".permalink-review-liveview").unbind("click"),$(".permalink-review-liveview").on("click",function(){e.popover_switch(this,e.get_popover_content);var t=this;e.permalink_uri({mode:"liveview",context:"viewer",datasource:"review",query:void 0}).then(function(o){e.popover_toggle(t,o)})}),$(".permalink-review-liveview-ttl").unbind("click"),$(".permalink-review-liveview-ttl").on("click",function(){e.popover_switch(this,e.get_popover_content);var t=this;e.permalink_uri_opaque({mode:"liveview",context:"viewer",datasource:"review",query:void 0}).then(function(o){e.popover_toggle(t,o)})})}}),opsChooserApp.addInitializer(function(){this.permalink=new PermalinkPlugin,this.listenTo(this,"application:ready",function(){this.permalink.setup_ui()}),this.listenTo(this,"results:ready",function(){this.permalink.setup_ui()})}),QueryModel=Backbone.Model.extend({}),ProjectModel=Backbone.RelationalModel.extend({sync:Backbone.localforage.sync("Project"),relations:[{type:Backbone.HasOne,key:"basket",relatedModel:"BasketModel",includeInJSON:Backbone.Model.prototype.idAttribute,reverseRelation:{type:Backbone.HasOne,key:"project",includeInJSON:Backbone.Model.prototype.idAttribute}}],defaults:{name:null,created:null,modified:null,queries:[]},initialize:function(){console.log("ProjectModel.initialize"),this.fetchRelated||(this.fetchRelated=this.getAsync)},record_query:function(e){var t=e.query+" ("+e.datasource+")";console.log("ProjectModel.record_query:",t);var o=!1,i=this.get("queries");_(i).last()!=t&&(i.push(t),o=!0),o&&(this.set("queries",i),this.save())},save:function(e,t,o){return this.set("modified",now_iso()),Backbone.Model.prototype.save.call(this,e,t,o)},destroy:function(e){var t=this.get("basket");return t&&(t.get("entries").each(function(e){e&&e.destroy()}),t.destroy()),Backbone.Model.prototype.destroy.call(this,e)}}),ProjectCollection=Backbone.Collection.extend({sync:Backbone.localforage.sync("Project"),find:Backbone.localforage.find,model:ProjectModel,initialize:function(){console.log("ProjectCollection.initialize")},sortByField:function(e,t){var o=this,i=function(e,t){return e=e.get(o.sort_key),t=t.get(o.sort_key),e>t?1:t>e?-1:0},n=function(e,t){return i(t,e)};return this.comparator=i,_.str.startsWith(t,"d")&&(this.comparator=n),this.sort_key=e,this.sort(),this},get_or_create:function(e,t){var o=this,i=this.where({name:e});if(i){var n=i[0],r=$.Deferred(),a=function(){t&&t.success&&t.success(n),r.resolve(n)};if(n)console.log("ProjectModel.load"),n.fetch({success:function(){$.when(n.fetchRelated("basket")).then(a)}});else{console.log("ProjectModel.create");var s=new BasketModel;s.save(null,{success:function(){n=new ProjectModel({name:e,created:now_iso(),basket:s}),o.create(n,{success:function(){o.add(n),$.when(n.fetchRelated("basket")).then(function(){var e=n.get("basket");e.save({project:n},{success:function(){n.fetch({success:function(){$.when(n.fetchRelated("basket")).then(a)}})}})})}})}})}return r}}}),ProjectChooserView=Backbone.Marionette.ItemView.extend({template:"#project-chooser-template",initialize:function(){console.log("ProjectChooserView.initialize"),this.data_list_selector="#project-chooser-list ul",this.listenTo(this.model,"change",this.render),this.listenTo(this,"item:rendered",this.setup_ui)},onDomRefresh:function(){console.log("ProjectChooserView.onDomRefresh")},projectname_validate:function(e){if(!e)return"Project name must not be empty";var t=this.collection.where({name:e});return _.isEmpty(t)?void 0:"Project name already exists"},setup_ui:function(){console.log("ProjectChooserView.setup_ui");var e=this;$("#project-chooser-name").editable({mode:"inline",placeholder:"Enter project name",success:function(t,o){e.model.set("name",o),e.model.save()},validate:function(t){return e.projectname_validate(t)}}),this.set_name(this.model.get("name"));var t=$(this.data_list_selector),o=this.collection;t.empty(),o.sortByField("modified","desc").each(function(e){var o=e.get("name"),i=e.get("modified"),n=_.template('<li><a class="incognito" href="javascript: void(0);" data-value="<%= name %>"><%= name %> <span class="pull-right"><%= modified %></span></a></li>')({name:o,modified:moment(i).fromNow()});t.append(n)}),t.find("a").click(function(){var e=$(this).data("value");opsChooserApp.trigger("project:load",e)}),$(this.el).find("#project-delete-button").click(function(){e.model.destroy({success:function(){var t=e.collection.sortByField("modified","desc").first();if(t){var o=t.get("name");opsChooserApp.trigger("project:load",o)}else{opsChooserApp.basketModel.destroy(),delete opsChooserApp.basketModel,opsChooserApp.trigger("projects:initialize");var i=$("#project-chooser-name").parent().parent();$(i).notify("recreated default project",{className:"info",position:"top"})}}})}),$(this.el).find("#project-create-button").unbind(),$(this.el).find("#project-create-button").click(function(t){t.stopPropagation(),t.preventDefault(),$(this).popover("hide");var o=$("#project-chooser-name");o.unbind();o.editable("getValue",!0);o.editable("destroy"),o.editable({mode:"inline",toggle:"manual",placeholder:"Enter project name",success:function(e,t){opsChooserApp.trigger("project:load",t)},validate:function(t){return e.projectname_validate(t)}}),o.editable("show"),o.editable("setValue",""),o.on("hidden",function(t,i){"save"!=i&&(o.editable("destroy"),e.setup_ui())})})},set_name:function(e){e?$("#project-chooser-name").editable("setValue",e):$("#project-chooser-name").hide()},clear:function(){this.set_name(),$(this.data_list_selector).empty()}}),opsChooserApp.addInitializer(function(){this.listenTo(this,"project:load",function(e){var t;this.project&&(t=this.project.get("name"));var o=this;$.when(this.projects.get_or_create(e)).done(function(i){o.trigger("project:ready",i),e!=t&&o.trigger("project:changed",i)})}),this.listenTo(this,"projects:initialize",function(e){console.log("projects:initialize"),e||(e=this.config.get("project")),this.projects=new ProjectCollection;var t=this;this.projects.fetch({success:function(){t.trigger("project:load",e)}})}),this.LOAD_IN_PROGRESS||this.trigger("projects:initialize")}),StoragePlugin=Marionette.Controller.extend({initialize:function(){console.log("StoragePlugin.initialize"),this.database_version="0.0.1"},dump:function(){var e=this,t=$.Deferred();return localforage.keys().then(function(o){var i={},n=[];_.each(o,function(e){var t=$.Deferred();n.push(t),localforage.getItem(e).then(function(o){i[e]=o,t.resolve()})}),$.when.apply($,n).then(function(){var o={database:i,metadata:{type:"elmyra.ipsuite.navigator.database",description:"Database dump of Elmyra IP suite navigator",software_version:opsChooserApp.config.get("setting.app.software.version"),database_version:e.database_version,database_name:localforage.config("name"),created:timestamp(),useragent:navigator.userAgent}};t.resolve(o)})}),t.promise()},dbexport:function(e){this.dump().then(function(t){var o=JSON.stringify(t,void 0,4),i=now_iso_human(),n="elmyra-ipsuite-navigator."+i+".database.json";if(!o)return void $(e).qnotify("Database export failed",{error:!0});var r=new Blob([o],{type:"application/json"});saveAs(r,n),$(e).qnotify("Database exported successfully")})},dbimport:function(e,t){var o=e;if("string"==typeof e){if(_.string.startsWith(e,"data:")){var i=dataurl.parse(e);if(i&&(e=i.data),!i||!e){var n="ERROR: data URL format is invalid";return console.error(n+"; payload="+e),void $(t).qnotify(n,{error:!0})}}try{o=jQuery.parseJSON(e)}catch(r){var a=r.message,n="ERROR: JSON format is invalid, "+a;return console.error(n+"; payload="+e),void $(t).qnotify(n,{error:!0})}}var s=dotresolve(o,"metadata.type"),c=dotresolve(o,"database");if("elmyra.ipsuite.navigator.database"!=s||!c){var n="ERROR: Database dump format is invalid";return console.error(n),void $(t).qnotify(n,{error:!0})}var l=[];_.each(_.keys(c),function(e){var t=$.Deferred();l.push(t.promise());var o=c[e];"Project"==e?localforage.getItem(e).then(function(i){i&&o&&(o=_.union(i,o)),localforage.setItem(e,o).then(function(){t.resolve()})}):localforage.setItem(e,o).then(function(){t.resolve()})}),$.when.apply($,l).then(function(){Backbone.Relational.store.reset(),opsChooserApp.trigger("projects:initialize"),$(t).qnotify("Database imported successfully")})},dbreset:function(e){e=e||{},e.shutdown_gui&&opsChooserApp.shutdown_gui(),Backbone.Relational.store.reset(),localforage.clear()},setup_ui:function(){var e=this;$("#data-export-button").unbind("click"),$("#data-export-button").on("click",function(){e.dbexport($(this).parent())}),$("#data-import-file").unbind("change"),$("#data-import-file").on("change",function(t){t.stopPropagation(),t.preventDefault();var o=this.files[0];$(this).val(void 0);var i=$(this).parent();if("application/json"!=o.type)return void $(i).qnotify("ERROR: File type is "+o.type+", but should be application/json",{error:!0});var n=new FileReader;n.onload=function(t){var o=t.target.result;e.dbimport(o,i)},n.onerror=function(e){$(i).qnotify("ERROR: Could not read file "+o.name+", message="+e.getMessage(),{error:!0})},n.readAsText(o)}),$("#data-import-button").unbind("dblclick"),$("#data-import-button").on("dblclick",function(){$("#data-import-file").click()}),$("#factory-reset-button").unbind("dblclick"),$("#factory-reset-button").on("dblclick",function(){e.dbreset({shutdown_gui:!0}),$(this).parent().find(".notifyjs-container").remove(),$(this).parent().qnotify("Database wiped successfully",{error:!0}),$(this).parent().parent().find(".notifyjs-container").last().qnotify("You should create a new project before starting over")})}}),DepatisnetSearch=Backbone.Model.extend({url:"/api/depatisnet/published-data/search",keywords:[],perform:function(e,t){indicate_activity(!0);var o=this;return this.fetch({data:$.param({query:e,range:t}),success:function(e,t,i){indicate_activity(!1),reset_content(),o.keywords=jQuery.parseJSON(i.xhr.getResponseHeader("X-Elmyra-Query-Keywords"))},error:function(e,t){indicate_activity(!1),reset_content(),opsChooserApp.documents.reset(),$("#alert-area").empty();try{var o=jQuery.parseJSON(t.responseText);"error"==o.status&&(_.each(o.errors,function(e){var t=_.template($("#cornice-error-template").html()),o=t(e);$("#alert-area").append(o)}),$(".very-short").shorten({showChars:0,moreText:"more",lessText:"less"}))}catch(i){var o=t.responseText;$("#alert-area").append(o)}}})}}),OpsPublishedDataSearch=Backbone.Model.extend({url:"/api/ops/published-data/search",keywords:[],perform:function(e,t,o,i){log("OpsPublishedDataSearch.perform"),indicate_activity(!0),$(opsChooserApp.paginationViewBottom.el).hide();var n=this;return this.fetch({data:$.param({query:o,range:i}),success:function(o,i,r){if(n.keywords=jQuery.parseJSON(r.xhr.getResponseHeader("X-Elmyra-Query-Keywords")),indicate_activity(!1),reset_content(),console.log("response data:"),console.log(i),_.isEmpty(i))return void e.reset();$(".pager-area").show();var a=i["ops:world-patent-data"]["ops:biblio-search"]["ops:search-result"],s=[];if(a){var c=to_list(a["exchange-documents"]);_(c).each(function(e){var t=e["exchange-document"];if("invalid result"==t["@status"])console.error("OPS INVALID RESULT:",e);else{var o=new OpsExchangeDocument(t);s.push(o)}})}e.reset(s);var l=i["ops:world-patent-data"]["ops:biblio-search"],u=l["@total-result-count"],d=l["ops:range"],p=d["@begin"]+"-"+d["@end"],h=l["ops:query"].$,m=h;t.set({result_count:u,result_range:p,result_count_received:s?s.length:0,query_origin:h,query_real:m}),t.set("keywords",_.union(n.keywords,t.get("keywords")))},error:function(e,t){indicate_activity(!1),reset_content({documents:!0});var t=jQuery.parseJSON(t.responseText);"error"==t.status&&(_.each(t.errors,function(e){var t=_.template($("#backend-error-template").html()),o=t(e);$("#alert-area").append(o)}),$(".very-short").shorten({showChars:0,moreText:"more",lessText:"less"}))}})}}),OpsExchangeMetadata=Backbone.Model.extend({defaults:{reviewmode:!1,datasource:null,searchmode:null,page_size:25,result_count:null,result_range:null,result_count_received:null,query_origin:null,query_real:null,pagination_entry_count:12,pagination_pagesize_choices:[25,50,75,100],keywords:[],get_url:function(){var e=window.location.pathname+"?query="+encodeURIComponent($("#query").val())+"&pagesize="+this.page_size;return e},get_url_print:function(){return this.get_url()+"&mode=print"},get_url_pdf:function(){var e=this.get_url()+"&pdf=true";return e}},initialize:function(){var e=$.url(window.location.href),t=e.param("pagesize");t&&this.set("page_size",parseInt(t))},resetToDefaults:function(){this.set(this.defaults)},resetSomeDefaults:function(){this.set(_(this.defaults).pick("datasource","searchmode","result_count","result_range","result_count_received","query_origin","query_real","keywords"))}}),OpsExchangeDocument=Backbone.Model.extend({defaults:{selected:!1,get_patent_number:function(){return this["@country"]+this["@doc-number"]+this["@kind"]},get_document_number:function(){return this.get_patent_number()},get_publication_number:function(e){var t=this.get_publication_reference(e);return(t.country||"")+(t.number||"")+(t.kind||"")},get_application_number:function(e){var t=this.get_application_reference(e);return(t.country||"")+(t.number||"")+(t.kind||"")},get_linkmaker:function(){return new Ipsuite.LinkMaker(this)},_flatten_textstrings:function(e){var t={};return _(e).each(function(e,o){if("@document-id-type"==o?o="type":"doc-number"==o&&(o="number"),"object"==typeof e){var i=e.$;i&&(e=i)}t[o]=e}),t},get_publication_reference:function(e){var t=this["bibliographic-data"]["publication-reference"]["document-id"],o=_(t).find(function(t){return t["@document-id-type"]==e});return this._flatten_textstrings(o)},get_application_reference:function(e){var t=this["bibliographic-data"]["application-reference"]["document-id"],o=_(t).find(function(t){return t["@document-id-type"]==e});return this._flatten_textstrings(o)},get_title_list:function(){var e=[],t=this["bibliographic-data"]["invention-title"];return t&&(e=_.map(to_list(t),function(e){var t=e["@lang"]&&"["+e["@lang"].toUpperCase()+"] "||"";return t+e.$})),e},get_abstract_list:function(){var e=[];if(this["abstract"])var t=to_list(this["abstract"]),e=t.map(function(e){var t=to_list(e.p),o=t.map(function(e){return e.$}).join(" "),i=e["@lang"]&&"["+e["@lang"].toUpperCase()+"] "||"";return i+o});return e},get_applicants:function(e){try{var t=this["bibliographic-data"].parties.applicants}catch(o){return[]}t=t||[];var i=t.applicant,n=this.parties_to_list(i,"applicant-name");return e&&(n=this.enrich_links(n,"applicant")),n},get_inventors:function(e){try{var t=this["bibliographic-data"].parties.inventors}catch(o){return[]}t=t||[];var i=t.inventor,n=this.parties_to_list(i,"inventor-name");return e&&(n=this.enrich_links(n,"inventor")),n},parties_to_list:function(e,t){var o="0",i={};_.each(e,function(e){var n=e["@data-format"],r=e["@sequence"],a=_.string.trim(e[t].name.$,", ");i[n]=i[n]||{},i[n][r]=a,r>o&&(o=r)});var n=[];return _.each(_.range(1,parseInt(o)+1),function(e){e=e.toString();var t=i.epodoc[e],o=i.original[e],r=o;t&&(r=t.replace(/\[.+?\]/,"").trim()),n.push(r)}),n},has_ipc:function(){return Boolean(this["bibliographic-data"]["classification-ipc"])},get_ipc_list:function(e){var t=[],o=this["bibliographic-data"]["classification-ipc"];if(o){var i=to_list(o.text);t=_.map(i,function(e){return e.$})}return e&&(t=this.enrich_links(t,"ipc",quotate)),t},has_ipcr:function(){return Boolean(this["bibliographic-data"]["classifications-ipcr"])},get_ipcr_list:function(e){var t=[],o=this["bibliographic-data"]["classifications-ipcr"];if(o){var i=to_list(o["classification-ipcr"]);t=_.map(i,function(e){return e.text.$})}return t=_(t).map(function(e){return e.substring(0,15).replace(/ /g,"")}),e&&(t=this.enrich_links(t,"ipc",quotate)),t},has_cpc:function(){return Boolean(this["bibliographic-data"]["patent-classifications"])},get_cpc_list:function(e){var t=[],o=this["bibliographic-data"]["patent-classifications"],i=["section","class","subclass","main-group","/","subgroup"],n=this;if(o){var r=to_list(o["patent-classification"]);_(r).each(function(e){var o=e["classification-scheme"]["@scheme"];if("CPC"==o){var r=[];_(i).each(function(t){if("/"==t)return void r.push("/");if(e[t]){var o=e[t].$;r.push(o)}else console.error('Unknown cpc classification field "'+t+'" for document "'+n.get_document_number()+'":',e)});var a=r.join("");t.push(a)}else"FI"==o||"FTERM"==o||console.error('Unknown classification scheme "'+o+'" for document "'+n.get_document_number()+'":',e)})}return e&&(t=this.enrich_links(t,"cpc",quotate)),t},get_priority_claims:function(){var e=this,t=[],o=this["bibliographic-data"]["priority-claims"];if(o){var i=to_list(o["priority-claim"]);_(i).each(function(o){var i=e.get_priority_claim_document_id(o,"epodoc"),n=e.enrich_link(i.number,"spr",i.number)+", "+moment(i.date,"YYYYMMDD").format("YYYY-MM-DD");t.push(n)})}return t},get_priority_claim_document_id:function(e,t){var o=to_list(e["document-id"]),i=_(o).find(function(e){return e["@document-id-type"]==t});return this._flatten_textstrings(i)},enrich_links:function(e,t,o){var i=this;return _.map(e,function(e){return i.enrich_link(e,t,e,o)})},enrich_link:function(e,t,o,i){if(o||(o=e),this.printmode)return o;var n="external",r="_blank",a=null;i&&(o=i(o)),_.string.include(o," ")&&(o='"'+o+'"');var s;if("internal"==n?s=_.template('<a href="" class="query-link" data-query-attribute="<%= attribute %>" data-query-value="<%= value %>"> <%= label %> </a>'):"external"==n&&(a=encodeURIComponent(t+"="+o),s=_.template('<a href="?query=<%= query %>" class="query-link incognito" target="<%= target %>"> <%= label %> </a>')),s){var c=s({label:e,attribute:t,value:o,target:r,query:a});return c}},_find_document_number:function(e,t){for(i in e){var o=e[i];if(o["@document-id-type"]==t){var n=(o.country?o.country.$:"")+(o["doc-number"]?o["doc-number"].$:"")+(o.kind?o.kind.$:"");return n}}},has_citations:function(){return Boolean(this["bibliographic-data"]["references-cited"])},get_patent_citation_list:function(e,t){t=t||"docdb";var o=this,i=[],n=this["bibliographic-data"]["references-cited"];if(n){var r=to_list(n.citation);i=r.filter(function(e){return e.patcit}).map(function(e){return o._find_document_number(e.patcit["document-id"],t)})}return e&&(i=this.enrich_links(i,"pn")),i},get_citing_query:function(){var e="ct="+this.get_publication_number("epodoc");return e},get_same_citations_query:function(){var e=this.get_patent_citation_list(!1,"epodoc");return this.get_items_query(e,"ct","OR")},get_all_citations_query:function(){var e=this.get_patent_citation_list(!1,"epodoc");return this.get_items_query(e,"pn","OR")},get_items_query:function(e,t,o){e=e.slice(0,10),e=e.map(function(e){return t+"="+e});var i=e.join(" "+o+" ");return i},_expand_links:function(e){var t=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/g;return _(e.match(t)).each(function(t){e=e.replace(t,'<a href="'+t+'" target="_blank">'+t+"</a>")}),e},get_npl_citation_list:function(){var e=this,t=[],o=this["bibliographic-data"]["references-cited"];if(o){var i=to_list(o.citation);t=i.filter(function(e){return e.nplcit}).map(function(e){return e.nplcit.text.$}).map(e._expand_links)}return t},has_fulltext:function(){var e=this["@country"],t=["EP","WO","AT","CA","CH"];return _(t).contains(e)}},initialize:function(){this.printmode="print"==opsChooserApp.config.get("mode")},get_document_number:function(){return this.attributes.get_patent_number()},select:function(){this.set("selected",!0)},unselect:function(){this.set("selected",!1)}}),OpsExchangeDocumentCollection=Backbone.Collection.extend({model:OpsExchangeDocument,initialize:function(){}}),OpsExchangeDocumentView=Backbone.Marionette.Layout.extend({template:_.template($("#ops-entry-template").html(),this.model,{variable:"data"}),tagName:"div",className:"row-fluid",regions:{region_comment_button:"#region-comment-button",region_comment_text:"#region-comment-text"},initialize:function(){console.log("OpsExchangeDocumentView.initialize"),this.templateHelpers.config=opsChooserApp.config},templateHelpers:{search_date:function(e){var t=null;return _.each(e,function(e){!t&&e.date&&e.date.$&&(t=e.date.$)}),t},format_date:function(e){return e?e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8):void 0}},events:{"click .rank_up img":"rankUp","click .rank_down img":"rankDown","click a.disqualify":"disqualify"}}),OpsExchangeDocumentCollectionView=Backbone.Marionette.CompositeView.extend({tagName:"div",id:"opsexchangedocumentcollection",className:"container",template:"#ops-collection-template",itemView:OpsExchangeDocumentView,initialize:function(){console.log("OpsExchangeDocumentCollectionView.initialize")
},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},onRender:function(){console.log("OpsExchangeDocumentCollectionView.onRender")}}),MetadataView=Backbone.Marionette.ItemView.extend({tagName:"div",template:_.template($("#ops-metadata-template").html(),this.model,{variable:"data"}),initialize:function(){this.templateHelpers.config=opsChooserApp.config,this.listenTo(this.model,"change",this.render)},templateHelpers:{}}),PaginationView=Backbone.Marionette.ItemView.extend({tagName:"div",template:"#ops-pagination-template",initialize:function(){console.log("PaginationView.initialize"),this.listenTo(this.model,"commit",this.render),this.listenTo(this,"item:rendered",this.setup_ui),this.templateHelpers.config=opsChooserApp.config},templateHelpers:{},getTemplate:function(){return"liveview"==opsChooserApp.config.get("mode")?"#ops-pagination-template-liveview":"subsearch"==this.model.get("searchmode")?"#ops-pagination-template-nopagesize":"#ops-pagination-template"},setup_ui:function(){console.log("PaginationView.setup_ui");var e=this,t=(this.model.get("datasource"),this.model.get("pagination_pagesize_choices")),o=this.model.get("page_size"),i=this.model.get("result_count"),n=this.model.get("pagination_entry_count"),r=this.model.get("result_range"),a=0;if(i>0&&o>0){var s=i/o;s>=1&&(a=Math.ceil(s)),a=_.min([a,n])}return 1>a?void $(".page-size-chooser").parent().remove():($(this.el).find(".page-size-chooser ul").each(function(){$(this).empty();var e=this;_(t).map(function(t){var i="";i=t==o?'<i class="icon-check"></i>':'<i class="icon-check-empty"></i>';var n=_.template('<li><a href="" data-value="<%= entry %>"><%= icon %> <%= entry %></a></li>')({entry:t,icon:i});$(e).append(n)})}),$(this.el).find(".page-size-chooser a").click(function(){var t=$(this).data("value");return e.model.set("page_size",t),opsChooserApp.perform_search(),!1}),$(this.el).find(".pagination ul").each(function(){$(this).empty();var e=this;_.range(1,a*o,o).map(function(t){var i=t,n=i+o-1,r=i+"-"+n,a=_.template('<li><a href="" range="<%= range %>"><%= range %></a></li>')({range:r});$(e).append(a)})}),$(this.el).find(".pagination a").click(function(){var e=$(this).attr("range");return opsChooserApp.perform_search({range:e}),!1}),void $(this.el).find(".pagination").find("a").each(function(e,t){var o=$(t).attr("range");if(o==r){var i=$(t).parent();i.addClass("active")}}))},onDomRefresh:function(){console.log("PaginationView.onDomRefresh")}}),function(){var e,t=this;e="undefined"!=typeof exports?exports:t.Ipsuite={};var o=e.LinkMaker=function(e){this.document=e,this.country=e["@country"],this.number=e["@doc-number"],this.kind=e["@kind"],Object.defineProperty(this,"document_number",{get:function(){return this.document.get_document_number()}})};_.extend(o.prototype,{drawing_url:function(){var e=_.template("/api/drawing/<%= document_number %>"),t=e({document_number:this.document_number});return t},fullimage_url:function(){var e=_.template("/api/ops/<%= patent_number %>/image/full"),t=e({patent_number:this.get_patent_number()});return t},espacenet_pdf_url:function(){var e=_.template("http://worldwide.espacenet.com/espacenetDocument.pdf?flavour=trueFull&FT=D&CC=<%= country %>&NR=<%= number %><%= kind %>&KC=<%= kind %>"),t=e(this);return t},ops_pdf_url:function(){var e=_.template("/api/ops/<%= country %><%= number %><%= kind %>/pdf/all"),t=e(this);return t},depatisnet_pdf_url:function(){var e=_.template("https://depatisnet.dpma.de/DepatisNet/depatisnet?action=pdf&docid=<%= country %><%= number %><%= kind %>"),t=e(this);return t},epo_register_url:function(){var e=this.document.get_application_reference("docdb"),t=_.template("https://register.epo.org/application?number=<%= country %><%= number %>"),o=t(e);return o},inpadoc_legal_url:function(){var e=_.template("http://worldwide.espacenet.com/publicationDetails/inpadoc?FT=D&CC=<%= country %>&NR=<%= number %><%= kind %>&KC=<%= kind %>"),t=e(this);return t},dpma_register_url:function(){var e=this.document.get_application_reference("docdb"),t=_.template("/office/dpma/register/application/<%= country %><%= number %>?redirect=true"),o=t(e);return o},uspto_pair_url:function(){var e=_.template("http://portal.uspto.gov/pair/PublicPair"),t=e(this);return t},inpadoc_family_url:function(){var e=_.template("http://worldwide.espacenet.com/publicationDetails/inpadocPatentFamily?FT=D&CC=<%= country %>&NR=<%= number %><%= kind %>&KC=<%= kind %>"),t=e(this);return t},ops_family_url:function(){var e=_.template("http://ops.epo.org/3.1/rest-services/family/publication/docdb/<%= country %>.<%= number %>.<%= kind %>/biblio,legal"),t=e(this);return t},ccd_viewer_url:function(){var e=this.document.get_application_reference("epodoc"),t=_.template("http://ccd.fiveipoffices.org/CCD-2.0.4/html/viewCcd.html?num=<%= number %>&type=application&format=epodoc"),o=t(e);return o},depatisnet_url:function(){var e=this.document.get_publication_reference("docdb"),t=_.template("https://depatisnet.dpma.de/DepatisNet/depatisnet?action=bibdat&docid=<%= country %><%= number %><%= kind %>"),o=t(e);return o},espacenet_worldwide_url:function(){var e=this.document.get_publication_reference("docdb"),t=_.template("http://worldwide.espacenet.com/publicationDetails/biblio?DB=worldwide.espacenet.com&FT=D&CC=<%= country %>&NR=<%= number %><%= kind %>&KC=<%= kind %>"),o=t(e);return o}})}.call(this);
//# sourceMappingURL=/static/js/app.min.map