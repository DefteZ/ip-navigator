## -*- coding: utf-8 -*-
## (c) 2013,2014 Andreas Motl, Elmyra UG

<%inherit file="site.mako" />

<%block name="body">

## http://bootsnipp.com/snipps/e-mail-interface-like-gmail
## http://davidsulc.com/blog/2012/04/15/a-simple-backbone-marionette-tutorial/
## https://github.com/davidsulc/backbone.marionette-collection-example

<%
query = request.params.get('query', '')
html_title = request.params.get('html-title', 'Patent search for "{0}"'.format(query))
page_title = request.params.get('page-title', 'Patent search')
page_subtitle = request.params.get('page-subtitle', '')
page_footer = request.params.get('page-footer', 'Data sources: EPO/OPS, DPMA/DEPATISnet, USPTO/PATIMG')
app_productname = request.params.get('app-productname', 'Elmyra <i class="circle-icon">IP</i> suite')
app_versionstring = request.params.get('app-versionstring', '<br/>Software release: ' + request.registry.settings.get('SOFTWARE_VERSION', ''))
ship_mode = request.params.get('ship-mode', 'multi-numberlist')
ship_url = request.params.get('ship-url', request.params.get('ship_url', ''))
ship_frame = request.params.get('ship-frame', 'opsbrowser_right_frame')
embed_item_url = request.params.get('embed-item-url', '')
%>
<script type="application/javascript">
var ship_mode = decodeURIComponent('${ship_mode}');
var ship_url = decodeURIComponent('${ship_url}');
var ship_frame = decodeURIComponent('${ship_frame}');
var embed_item_url = decodeURIComponent('${embed_item_url}');
var PRINTMODE = '${printmode}' == 'True' ? true : false;
</script>

## title / headline
<div class="container-fluid">
    <div class="span9">
        <div class="pull-left">
            <h3 style="display: inline-block">${page_title | n}</h3>
            ${page_subtitle}
        </div>
    </div>
    <div class="span3">
        <div class="pull-right">
            <h3>${app_productname | n}</h3>
        </div>
    </div>
</div>

<br/>

<div class="container-fluid span12">

    ## query builder and basket
    <div class="row-fluid do-not-print" id="querybuilder-basket-area">

        <div class="span8" id="querybuilder-area">

            <div class="row-fluid">

                <!-- data source chooser -->
                <div class="span12">
                    <div id="datasource" class="btn-group pull-right" data-toggle="buttons-radio">
                        <button class="btn active" data-value="ops">
                            <img src="/static/img/icons/epo-logo-small.svg" width="20" height="20"/> OPS
                        </button>
                        <button class="btn" data-value="depatisnet">
                            <img src="/static/img/icons/dpma-logo-small.svg" width="24" height="24"/> DEPATISnet
                        </button>
                        <button
                            class="btn btn-popover basket-review-button" data-value="review"
                            data-toggle="popover" data-trigger="hover" data-placement="bottom"
                            data-content="Review list of selected documents"
                            >
                            <i class="icon-pencil"></i> Review
                        </button>
                    </div>
                </div>
            </div>

            <div class="row-fluid">

                <!-- query string -->
                <div class="span12">
                    <textarea class="span12" id="query" name="query" placeholder="CQL expression" rows="5">${query}</textarea>
                </div>

                <!--
                <div class="span1">

                    <div id="cql-quick-operator" class="btn-group" data-toggle="buttons-radio">
                        <button class="btn-cql-boolean btn btn-mini active" type="button" data-value="OR">OR</button>
                        <button class="btn-cql-boolean btn btn-mini"        type="button" data-value="AND">AND</button>
                    </div>

                    <a class="btn-cql-field label label-success" data-value="num=">num=</a>
                    <a class="btn-cql-field label label-info" data-value="txt=">txt=</a>
                    <a class="btn-cql-field label label-important" data-value="cl=">cl=</a>

                </div>
                -->

            </div>

            <div class="row-fluid">

                <!-- send query to database -->
                <div class="span4">

                    <div
                        class="btn-group btn-popover"
                        data-toggle="popover" data-trigger="hover" data-placement="right"
                        data-content="Send query to database"
                        >
                        <button type="submit" role="button" class="btn btn-query-perform">
                            <i class="icon-search" id="idler"></i>
                            <i class="icon-refresh icon-spin" style="display: none" id="spinner"></i>
                        </button>
                        <button type="submit" role="button" class="btn btn-query-perform">
                            Send query
                        </button>
                    </div>

                </div>

                <!-- cql field symbol chooser -->
                <div class="span6">
                    <div id="cql-field-chooser" name="cql-field-chooser" size="1"></div>
                </div>

                <!-- query content transformation and clearing -->
                <div class="span2">
                    <div id="query-action" class="btn-group pull-right">

                        <div id="cql-history-chooser" class="btn-group">

                            <button
                                    id="btn-query-history"
                                    class="btn dropdown-toggle" data-toggle="dropdown"
                                    >
                                <i class="icon-time icon-large btn-popover"
                                   data-toggle="popover" data-trigger="hover" data-placement="top"
                                   data-content="Query history"
                                        ></i>
                            </button>

                            <div id="cql-history-chooser-container" class="dropdown-menu pull-right">
                                <div id="cql-history-chooser-select2" class="span12"></div>
                            </div>

                        </div>

                        <button
                            id="btn-query-transform"
                            class="btn btn-popover"
                            data-toggle="popover" data-trigger="hover" data-placement="bottom"
                            data-content="Transform query"
                            >
                            <i class="icon-exchange icon-large"></i>
                        </button>
                        <button
                            id="btn-query-clear"
                            class="btn btn-popover"
                            data-toggle="popover" data-trigger="hover" data-placement="bottom"
                            data-content="Clear query"
                            >
                            <i class="icon-trash icon-large"></i>
                        </button>
                    </div>
                </div>

            </div>

        </div>

        <!-- xxx -->
        <div class="span4 row-fluid">
            <div class="span12">
                <!-- project chooser -->
                <div id="project-chooser-area" class="pull-right"></div>
            </div>
        </div>

        % if ship_mode != 'single-bibdata':
        <div class="span4" id="basket-area"></div>
        % endif

    </div>


    ## pager top
    <div class="pager-area do-not-print" id="ops-pagination-region-top"></div>

    ## notifications and alerts
    <div id="alert-area"></div>
    <div id="info-area"></div>

    ## results
    <div id="ops-metadata-region"></div>
    <div id="ops-collection-region"></div>

    ## pager bottom
    <div class="pager-area do-not-print" id="ops-pagination-region-bottom"></div>

    <hr class="clear-margin" style="margin-top: 50px"/>
    <div class="page-footer pull-left">
        &copy; 2013-2014, Elmyra UG — All rights reserved.
    </div>
    <div class="page-footer pull-right">
        <small>
            <div style="text-align: right">
                ${page_footer | n}
                ${app_versionstring | n}
                <span class="do-not-print">
                    <br/>
                    Help: <a id="link-help" class="incognito"><i class="icon-question-sign icon-large"></i></a>
                </span>
            </div>
        </small>
    </div>

</div>


<!-- modal dialog for viewing online help -->
<div id="help-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="help-modal-label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="help-modal-label">Online help</h3>
    </div>
    <div class="modal-body" id="help-body">
        <a href="https://en.wikipedia.org/wiki/Contextual_Query_Language" target="_blank">About CQL</a>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>


<!-- modal dialog for choosing clipboard content modifier -->
<div id="clipboard-modifier-chooser" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="clipboard-modifier-chooser-label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="clipboard-modifier-chooser-label">Query transformation</h3>
    </div>
    <div class="modal-body">
        Transform newline-separated data to syntactically correct query.
        <br/><br/>
        <div class="btn-group btn-group-vertical">
            <button class="btn btn-large btn-success btn-clipboard-modifier" data-modifier="num">
                <strong>Number: Publication-, application- or priority number</strong>
                <br/><br/>
                <small>e.g. "num=DE102012220639A1 OR num=DE102013201031A1 OR num=..."</small>
            </button>
            <button class="btn btn-large btn-info btn-clipboard-modifier" data-modifier="txt">
                <strong>Text: Title, abstract, inventor-, or applicant name</strong>
                <br/><br/>
                <small>e.g. "txt=siemens OR txt=alstom OR txt=..."</small>
            </button>
            <button class="btn btn-large btn-danger btn-clipboard-modifier" data-modifier="cl">
                <strong>Class: CPC or IPC8 class</strong>
                <br/><br/>
                <small>e.g. "cl=H04L12/24 OR cl=H04L12/26 OR cl=..."</small>
            </button>
        </div>
    </div>
    <div class="modal-footer">
        <div id="clipboard-modifier-operator" class="btn-group pull-left" data-toggle="buttons-radio">
            <button class="btn active" type="button" data-value="OR">OR</button>
            <button class="btn"        type="button" data-value="AND">AND</button>
        </div>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>


## ------------------------------------------
##   pager template
## ------------------------------------------
<%text>
<script type="text/x-underscore-template" id="ops-pagination-template">
    <div id="pagination-widget">

        <div class="row-fluid" id="pagination-chooser">

            <div class="span2">
                <div class="btn-group btn-popover page-size-chooser"
                            data-toggle="popover" data-trigger="hover" data-placement="right"
                            data-content="Select page size"
                    >
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <i class="icon-resize-vertical"></i> &nbsp; Page size
                    </button>
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                    </ul>
                </div>
            </div>

            <div class="span10 pagination">
                <ul class="pull-right">
                    <!--
                    <li><a href="#" action="previous">Prev</a></li>
                    -->
                    <!--
                    <li><a href="#" action="next">Next</a></li>
                    -->
                </ul>
            </div>
        </div>

    </div>
</script>

<script type="text/x-underscore-template" id="ops-pagination-template-nopagesize">
    <div id="pagination-widget">

        <div class="row-fluid" id="pagination-chooser">

            <div class="span12 pagination">
                <ul class="pull-right">
                    <!--
                    <li><a href="#" action="previous">Prev</a></li>
                    -->
                    <!--
                    <li><a href="#" action="next">Next</a></li>
                    -->
                </ul>
            </div>
        </div>

    </div>
</script>
</%text>

<script id="backend-error-template" type="text/x-underscore-template">

    <div class="alert alert-error alert-block">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4>ERROR</h4>
        <%text>

        <dl class="dl-horizontal dl-horizontal-biblio2">

            <dt>
                Message
            </dt>
            <dd>
                <h4><%= description['content'] %></h4>
            </dd>

            <br/>

            <dt>
                Date
            </dt>
            <dd>
                <%= description['headers']['date'] %>
            </dd>

            <dt>
                Status
            </dt>
            <dd>
                <%= description['status_code'] %> <%= description['reason'] %>
            </dd>

            <dt>
                Name
            </dt>
            <dd>
                <%= name %>
            </dd>

            <dt>
                Location
            </dt>
            <dd>
                <%= location %>
            </dd>

            <dt>
                URL
            </dt>
            <dd>
                <%= description['url'] %>
            </dd>

        </dl>
        </%text>

    </div>

</script>


<script id="cornice-error-template" type="text/x-underscore-template">

    <div class="alert alert-error alert-block">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4>ERROR</h4>
        <%text>

        <dl class="dl-horizontal dl-horizontal-biblio2">

            <dt>
                Message
            </dt>
            <dd>
                <h4><%= description %></h4>
            </dd>

            <br/>

            <dt>
                Name
            </dt>
            <dd>
                <%= name %>
            </dd>

            <dt>
                Location
            </dt>
            <dd>
                <%= location %>
            </dd>

        </dl>
        </%text>

    </div>

</script>


<script id="alert-template" type="text/x-underscore-template">
    <%text>
    <div class="alert alert-block <%= clazz %>">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4><%= title %></h4>
        <br/>
        <%= description %>
    </div>
    </%text>
</script>


<script id="cql-field-chooser-entry" type="text/x-underscore-template">
<%text>

    <div class="row-fluid">
        <div class="span5 strong">
            <%= label %>
        </div>
        <div class="span4">
            <%= _(fields).first() %>
            <br/>
            <small><%= _(fields).rest(1).join('<br/>') %></small>
        </div>
        <div class="span3">
            <%= more %>
        </div>
    </div>

</%text>
</script>

<!-- application -->
<link rel="stylesheet" type="text/css" href="/static/css/app.css" />

<!-- user interface: templates -->
<%include file="basket.html"/>
<%include file="project.html"/>
<%include file="ops.html"/>


<!-- storage -->
<script type="text/javascript" src="/static/js/lib/backbone-relational.js"></script>
<script type="text/javascript" src="/static/js/lib/localforage-0.8.1.min.js"></script>
<!-- TODO: minify again, but currently includes an important patch -->
<!-- <script type="text/javascript" src="/static/js/lib/localforage.backbone-0.4.0.min.js"></script> -->
<script type="text/javascript" src="/static/js/lib/localforage.backbone.js"></script>

<!-- user interface: libraries -->
<script type="text/javascript" src="/static/js/lib/jquery.caret-1.5.1.min.js"></script>
<script type="text/javascript" src="/static/js/lib/jquery.hotkeys.js"></script>
<script type="text/javascript" src="/static/js/lib/jquery-keyword-highlight.js"></script>
<script type="text/javascript" src="/static/js/lib/jquery-autonumeric.js"></script>
<script type="text/javascript" src="/static/js/lib/jquery.viewport.min.js"></script>
<script type="text/javascript" src="/static/js/lib/bootbox-2.3.2.min.js"></script>
<script type="text/javascript" src="/static/js/lib/moment-with-langs.min.js"></script>
<script type="text/javascript" src="/static/js/lib/bootstrap-tab-button.js"></script>
<script type="text/javascript" src="/static/js/lib/notify-combined.min.js"></script>

<!-- user interface: widgets -->
<script type="text/javascript" src="/static/widget/bootstrap-editable/js/bootstrap-editable.min.js"></script>
<link rel="stylesheet" type="text/css" href="/static/widget/bootstrap-editable/css/bootstrap-editable.css" />

% if request.registry.settings.get('ipsuite.production') == 'true':
    <script type="text/javascript" src="/static/js/app.min.js"></script>
% else:
    <script type="text/javascript" src="/static/js/ipsuite/linkmaker.js"></script>
    <script type="text/javascript" src="/static/js/app/util.js"></script>
    <script type="text/javascript" src="/static/js/app/core.js"></script>
    <script type="text/javascript" src="/static/js/app/ops-sdk.js"></script>
    <script type="text/javascript" src="/static/js/app/models/ops.js"></script>
    <script type="text/javascript" src="/static/js/app/models/depatisnet.js"></script>
    <script type="text/javascript" src="/static/js/app/views/ops.js"></script>
    <script type="text/javascript" src="/static/js/app/views/pagination.js"></script>
    <script type="text/javascript" src="/static/js/app/main.js"></script>
    <script type="text/javascript" src="/static/js/app/components/basket.js"></script>
    <script type="text/javascript" src="/static/js/app/components/project.js"></script>
% endif

</%block>
