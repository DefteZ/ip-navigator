## -*- coding: utf-8 -*-
## (c) 2013-2017 Andreas Motl, Elmyra UG

## ------------------------------------------
##   ops family templates
## ------------------------------------------
<%text>
<script id="ops-family-verbose-collection-template" type="text/x-underscore-template">

    <table class="table table-condensed">
        <thead>
        <tr>
            <th class="span1">PDF</th>
            <th class="span3">Publication</th>
            <th class="span3">Application</th>
            <th class="span2">Priority</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

</script>
<script id="ops-family-verbose-member-template" type="text/x-underscore-template">

    <%
    //log('family member:', data);
    var pubref = data.get_publication_reference(null, 'docdb');
    var appref = data.get_application_reference(null, 'docdb');
    var linkmaker = new Ipsuite.LinkMaker();
    %>

    <td>
        <!-- pdf document -->
        <a href="<%= linkmaker.universal_pdf_url(pubref.fullnumber) %>" target="ipsuite-pdf"
           class="btn btn-small btn-popover anchor-pdf do-not-print" role="button"
           data-toggle="popover" data-trigger="hover" data-placement="top"
           data-content="PDF document"
                >
            <%= opsChooserApp.ui.pdf_icon() %>
        </a>
    </td>
    <td>
        <%= data.enrich_link(pubref.fullnumber, 'pn') %>
        <br/>
        <%= pubref.isodate %>
    </td>
    <td>
        <%= appref.fullnumber %>
        <br/>
        <%= appref.isodate %>
        <%
        if (data['application-reference']['@is-representative'] == 'YES') {
            print('<br/>');
            print('representative: yes');
        }
        %>
    </td>
    <td>
        <%
        _(to_list(data['priority-claim'])).each(function(priority) {
            //log('priority:', priority);
            var document_id = data.get_document_id(priority, null, 'docdb');
            print(document_id.fullnumber);
            print('<br/>');
            print(document_id.isodate);
            print('<br/>');
            if (priority['priority-active-indicator'] && priority['priority-active-indicator']['$'] == 'YES') {
                print('active: yes');
                print('<br/>');
            }
        });
        %>
    </td>

</script>


<script id="ops-family-compact-collection-template" type="text/x-underscore-template">
    <table class="table table-condensed span6">
        <thead>
        <tr>
            <th class="span1">PDF</th>
            <th class="span2">Publication</th>
            <th class="span2">Date</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <%
            var family_members = data.get_patent_family_member_list('epodoc');
            var family_members_comma = family_members.join(',');
            %>
            <td>
            </td>
            <td colspan="2">
                <a href="?numberlist=<%= encodeURIComponent(family_members_comma) %>" class="query-link" target="_blank">
                    All family members (#<%= family_members.length %>)
                </a>
            </td>
        </tr>
        </tbody>
    </table>
</script>
<script id="ops-family-compact-member-template" type="text/x-underscore-template">

    <%
    //log('family member:', data);
    var pubref = data.get_publication_reference(null, 'docdb');
    var linkmaker = new Ipsuite.LinkMaker();
    %>

    <td>
        <!-- pdf document -->
        <a href="<%= linkmaker.universal_pdf_url(pubref.fullnumber) %>" target="ipsuite-pdf"
           class="btn btn-small btn-popover anchor-pdf do-not-print" role="button"
           data-toggle="popover" data-trigger="hover" data-placement="top"
           data-content="PDF document"
                >
            <%= opsChooserApp.ui.pdf_icon() %>
        </a>
    </td>

    <td>
        <%= data.enrich_link(pubref.fullnumber, 'pn', null, null, {'no_modifiers': true}) %>
    </td>

    <td>
        <%= pubref.isodate %>
    </td>

</script>


<script id="ops-family-citations-collection-template" type="text/x-underscore-template">
    <table class="table table-condensed">
        <thead>
        <tr>
            <th class="span1">Explore</th>
            <th class="span2">Publication</th>
            <th class="span7">References cited</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><%= data.get_citations_environment_button() %></td>
            <td></td>
            <td>Citation references from all family members (#<%= data.get_patent_citation_list(false, 'epodoc').length %>)</td>
        </tr>
        <tr>
            <td><%= data.get_citations_environment_button({members_no_us: true}) %></td>
            <td></td>
            <td>Citation references from non-US family members</td>
        </tr>
        </tbody>
    </table>
</script>
<script id="ops-family-citations-member-template" type="text/x-underscore-template">

    <%
    //log('family member:', data);
    var pubref = data.get_publication_reference(null, 'docdb');
    %>

    <td>
        <%= data.get_citations_environment_button() %>
    </td>

    <td>
        <%= data.enrich_link(pubref.fullnumber, 'pn', null, null, {'no_modifiers': true}) %>
        <br/>
        <%= pubref.isodate %>
    </td>

    <td>
        <%= data.get_patent_citation_list(true).join(', ') || '&nbsp;' %>
    </td>

</script>
</%text>


## ------------------------------------------
##   modal dialog for viewing pdf
## ------------------------------------------
<div id="ops-pdf-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="ops-pdf-modal-label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="ops-pdf-modal-label"></h3>
    </div>
    <div class="modal-body" id="pdf">
    </div>
    <div class="modal-footer">
        <div class="btn-group pull-left">
            <button class="btn btn-primary" id="pdf-previous">Previous</button>
            <button class="btn btn-primary" id="pdf-next">Next</button>
        </div>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
